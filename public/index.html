<html>
<head>
	<meta charset="utf-8">
	<title>Carplay</title>

	<script src="js/http-live-player.js"></script>
</head>
<body>

<!--	<div>-->
<!--		<img id="x" src="data:image/png;base64,">-->
<!--	</div>-->

<script type="text/javascript">
	const URL = "ws://" + document.location.host;

	const canvas = document.createElement("canvas");
	document.body.appendChild(canvas);

	const player = new WSAvcPlayer(canvas, "webgl", 1, 35);
	player.connect(URL);
	window.wsavc = player;



	//
	// let socket
	// let connected = false
	//
	// socket = new WebSocket("ws://192.168.0.216:3000/video");
	//
	// socket.onmessage = async function(event) {
	// 	// console.log(await event.data.text())
	// 	document.getElementById("x").src = "data:image/png;base64," + await event.data.text();
	// };
	//
	// socket.onopen = function(e) {
	// 	console.log("[open] Connection established");
	// 	connected = true
	// };
	// socket.onclose = function(event) {
	// 	if (event.wasClean) {
	// 		console.log(`[close] Connection closed cleanly, code=${event.code} reason=${event.reason}`);
	// 	} else {
	// 		// e.g. server process killed or network down
	// 		// event.code is usually 1006 in this case
	// 		console.log('[close] Connection died');
	// 	}
	// 	connected = false
	// };
	// socket.onerror = function(error) {
	// 	console.error(`[error] ${error.message}`);
	// 	connected = false
	// };
</script>

<script>
	canvas.draggable = false;
	let mousedown = false;

	const mouse = (type, event) => {
		// fetch(`http://localhost:3000/event?type=${type}&x=${event.offsetX}&y=${event.offsetY}`, {method: 'POST', cache: 'no-cache'});
		player.send(type, event.offsetX, event.offsetY)
	}

	canvas.onpointerdown = (event) => {
		mouse("down", event);
		mousedown = true;
	};
	canvas.onpointermove = (event) => {
		if (mousedown)
			mouse("move", event);
	};
	canvas.onpointerup = (event) => {
		mousedown = false;
		mouse("up", event);
	};


</script>

</body>
</html>
